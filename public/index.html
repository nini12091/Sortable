<!DOCTYPE html>
<html>
<head>
	<title>Sortable</title>

	<!-- meta -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!-- stylesheet -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<style>
		th {
			background-color: #4d4d4d;
			font-size: 1em;
			font-weight: normal;
			color: white;
		}

		th:hover {
			opacity: 0.9;
		}

		td {
			font-size: 0.7em;
		}

		/* 셀이 hovering 되었을 때의 클래스입니다 */
		.cell-hover {
			background-color: #f2f2f2;
		}

		/* Ascending, Descending 정렬 버튼을 위한 클래스입니다 */
		.cell-sort {
			margin-left: 0.2em;
		}

		/* 셀이 클릭되었을 때의 클래스입니다 */
		.cell-active {

		}

		/* PC에서 line이 hovering되었을 때의 클래스입니다 */
		.line-hover {
			stroke: blue;
		}

		/* PC에서 line이 클릭되었을 때의 클래스입니다 */
		.line-active {
			stroke-width: 2;
		}

		/* 텍스트 드래그 방지를 위한 클래스입니다 */
		.noselect {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
			-o-user-select: none;
			user-select: none;    
		}

		.background {
			fill: none;
			stroke: lightgray;
		}

		.foreground {
			fill: none;
			stroke: steelblue;
		}

		.controller {

		}

		.controller:hover {
			opacity: 0.9;
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<!-- header -->
		<h1 class="display-5 my-3 py-3">Sortable</h1>

		<!-- control buttons -->
		<button type="button" onclick="Data.reset()">Reset</button>

		<!-- sort buttons -->
		<!-- <form class="mt-3">
			<label><input id="sort-relative" type="radio" value="sortRelative" name="mode" checked> Sort relative </label>
			<label><input id="sort-parallel" type="radio" value="sortParallel" name="mode"> Sort parallel </label>
		</form> -->

		<div id="controller"></div>

		<div id="layout">
			<!-- parallel coordinates -->
			<svg id="pc" width="960" height="540"></svg>

			<!-- sortable -->
			<div id="sortable"></div>
		</div>
	</div>
</body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="Data.js"></script>
<script src="Table.js"></script>
<script src="PC.js"></script>
<script type="text/javascript">

function Controller(controller, data){
	this.el.root = d3.select(controller);
	this.data = data;

	this.el.root.attr("class", "controller position-sticky sticky-top mx-auto")
			.style("background-color", "#333")
			.style("color", "#f2f2f2")
			.style("width", "100%")
		.selectAll("div")
			.data(this.data.headers)
		.enter().append("div")
			.style("display", "inline-block")
			.style("width", 100 / this.data.headers.length + "%")
			.style("text-align", "center")
			.style("padding", "8px")
			.text(function(header){ return header.name; });
			// .on("mouseover", (header) => {
			// 	this.data.dispatch("hoverstart", header);
			// })
			// .on("mouseout", (header) => {
			// 	this.data.dispatch("hoverend", header);
			// });
}

Controller.prototype.el = {};

function Container(div, data){
	this.el.root = d3.select(div);
	this.data = data;

	this.controllers.headers = new Controller("#controller", data);

	// default
	this.resize = this.horizontal;
	this.resize();

	// handle window resize
	d3.select(window).on("resize", () => {
		this.resize();
	});
}

Container.prototype.el = {};
Container.prototype.childrens = [];
Container.prototype.controllers = {};

Container.prototype.horizontal = function(){
	this.el.root.attr("class", "row");
	var rect = this.el.root.node().parentNode.getBoundingClientRect(); // get real size
	this.childrens.forEach((children) => {
		d3.select(children.el.root.node().parentNode).attr("class", "col-6");
		var childrect = children.el.root.node().parentNode.getBoundingClientRect();
		children.width(childrect.width);
		children.height(childrect.height);
	});
	this.resize = this.horizontal;
}

Container.prototype.vertical = function(){
	this.el.root.attr("class", "container");
	this.resize = this.vertical;
}

Container.prototype.addChildren = function(children){
	this.el.root.append("div").append(function(){
		return children.el.root.remove().node();
	});
	this.childrens.push(children);

	this.resize();
}

var container;
var table, pc;
var data;

// Load data from assets
d3.csv("data.csv").then(function(_data){
	data = new Data(_data);

	// plot
	container = new Container("#layout", data);
	table = new Table("#sortable", data);
	pc = new PC("#pc", data);

	container.addChildren(pc);
	container.addChildren(table);
});

</script>
</html>